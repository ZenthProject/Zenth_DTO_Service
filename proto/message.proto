syntax = "proto3";

package message;

// Message chiffré à transmettre
message Request {
  MessageRequest requete_global = 1;
}

message MessageRequest {
  bytes client_nonce = 1;
  int64 timestamp = 2;
  EncryptedEnvelope envelope = 10;
}

message EncryptedEnvelope {
  bytes client_ephemeral_pub = 1;
  repeated KeyWrap key_wraps = 2;
  Layer2Ciphertext layer2 = 3;
  bytes hmac = 4;
  bytes client_signature = 5;
}

message Layer2Ciphertext {
  bytes ciphertext = 1;
  bytes nonce = 2;
  Layer1Ciphertext layer1 = 3;
  bytes aead_tag = 4;
}

message Layer1Ciphertext {
  bytes ciphertext = 1;
  bytes nonce = 2;
  InnerMessagePayload inner = 3;
  bytes aead_tag = 4;
}

message KeyWrap {
  string alg = 1;
  bytes wrapped_key = 2;
  bytes key_id = 3;
}

message InnerMessagePayload {
  bytes message_body = 1; // Peut être texte, fichier, ou autre
  bytes recipient_pubkey = 2;
  int64 timestamp = 3;
}
