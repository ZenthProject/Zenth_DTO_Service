syntax = "proto3";

package login;

// Requête de login entièrement chiffrée
message Request {
  LoginRequest requete_global = 1;
}

message LoginRequest {
  bytes client_nonce = 1;
  int64 timestamp = 2;
  EncryptedEnvelope envelope = 10;
}

// Même structure que dans register.proto
message EncryptedEnvelope {
  bytes client_ephemeral_pub = 1;
  repeated KeyWrap key_wraps = 2;
  Layer2Ciphertext layer2 = 3;
  bytes hmac = 4;
  bytes client_signature = 5;
}

message Layer2Ciphertext {
  bytes ciphertext = 1;
  bytes nonce = 2;
  Layer1Ciphertext layer1 = 3;
  bytes aead_tag = 4;
}

message Layer1Ciphertext {
  bytes ciphertext = 1;
  bytes nonce = 2;
  InnerLoginPayload inner = 3;
  bytes aead_tag = 4;
}

message KeyWrap {
  string alg = 1;
  bytes wrapped_key = 2;
  bytes key_id = 3;
}

message InnerLoginPayload {
  string username = 1;
  bytes password_proof = 2;
  int64 timestamp = 3;
}
